using System.Collections.Generic;
using System.Linq;
using System.Net;

namespace IranianMinerDetector.WinForms.Data
{
    public static class IranianISPs
    {
        private static List<ISPInfo>? _isps;

        public static List<ISPInfo> ISPs => _isps ??= LoadISPs();

        public static List<string> ISPNames => ISPs.Select(i => i.Name).ToList();

        private static List<ISPInfo> LoadISPs()
        {
            return new List<ISPInfo>
            {
                new ISPInfo
                {
                    Name = "Iran Telecommunication Company (TCI)",
                    NamePersian = "مخابرات ایران",
                    ASN = "AS12880",
                    IPRanges = new List<string>
                    {
                        "2.176.0.0/15", "2.178.0.0/16", "2.179.0.0/16",
                        "5.23.0.0/16", "5.28.0.0/16", "5.34.0.0/16",
                        "5.56.0.0/16", "5.62.0.0/16", "5.74.0.0/16",
                        "5.106.0.0/16", "5.118.0.0/16", "5.144.0.0/16",
                        "5.200.0.0/16", "31.7.0.0/16", "31.24.0.0/16",
                        "37.32.0.0/16", "37.49.0.0/16", "37.98.0.0/16",
                        "37.114.0.0/16", "37.128.0.0/16", "37.130.0.0/16",
                        "37.137.0.0/16", "37.152.0.0/16", "37.191.0.0/16",
                        "37.221.0.0/16", "37.255.0.0/16", "46.32.0.0/16",
                        "46.36.0.0/16", "46.38.0.0/16", "46.100.0.0/16",
                        "46.102.0.0/16", "46.143.0.0/16", "46.148.0.0/16",
                        "46.151.0.0/16", "46.167.0.0/16", "46.182.0.0/16",
                        "46.198.0.0/16", "46.209.0.0/16", "46.224.0.0/16",
                        "62.60.0.0/16", "62.193.0.0/16", "62.220.0.0/16",
                        "77.36.0.0/16", "77.77.0.0/16", "77.104.0.0/16",
                        "77.237.0.0/16", "77.238.0.0/16", "78.38.0.0/16",
                        "78.39.0.0/16", "78.109.0.0/16", "78.110.0.0/16",
                        "78.111.0.0/16", "79.127.0.0/16", "79.132.0.0/16",
                        "79.175.0.0/16", "80.71.0.0/16", "80.75.0.0/16",
                        "80.191.0.0/16", "81.12.0.0/16", "81.31.0.0/16",
                        "81.90.0.0/16", "81.91.0.0/16", "82.99.0.0/16",
                        "82.115.0.0/16", "85.9.0.0/16", "85.15.0.0/16",
                        "85.133.0.0/16", "85.185.0.0/16", "85.198.0.0/16",
                        "87.107.0.0/16", "87.247.0.0/16", "87.248.0.0/16",
                        "88.135.0.0/16", "91.98.0.0/16", "91.99.0.0/16",
                        "91.184.0.0/16", "91.185.0.0/16", "91.186.0.0/16",
                        "91.232.0.0/16", "91.236.0.0/16", "91.239.0.0/16",
                        "91.241.0.0/16", "91.242.0.0/16", "91.247.0.0/16",
                        "92.42.0.0/16", "93.110.0.0/16", "93.117.0.0/16",
                        "93.118.0.0/16", "94.74.0.0/16", "94.101.0.0/16",
                        "94.139.0.0/16", "94.182.0.0/16", "94.183.0.0/16",
                        "94.184.0.0/16", "94.232.0.0/16", "94.241.0.0/16",
                        "95.38.0.0/16", "95.80.0.0/16", "95.81.0.0/16",
                        "95.82.0.0/16", "95.130.0.0/16", "95.215.0.0/16",
                        "176.221.0.0/16", "176.56.0.0/16", "176.67.0.0/16",
                        "176.101.0.0/16", "178.131.0.0/16", "178.216.0.0/16",
                        "178.236.0.0/16", "178.238.0.0/16", "178.239.0.0/16",
                        "178.251.0.0/16", "178.252.0.0/16", "178.253.0.0/16",
                        "188.121.0.0/16", "188.136.0.0/16", "188.158.0.0/16",
                        "194.225.0.0/16"
                    },
                    RiskScore = 0.4
                },
                new ISPInfo
                {
                    Name = "Irancell (MTN Iran)",
                    NamePersian = "ایرانسل",
                    ASN = "AS197207",
                    IPRanges = new List<string>
                    {
                        "5.114.0.0/16", "5.116.0.0/16", "5.117.0.0/16",
                        "5.119.0.0/16", "5.122.0.0/16", "5.125.0.0/16",
                        "5.127.0.0/16", "5.153.0.0/16", "5.198.0.0/16",
                        "5.202.0.0/16", "5.233.0.0/16", "31.25.0.0/16",
                        "31.170.0.0/16", "37.10.0.0/16", "37.11.0.0/16",
                        "37.17.0.0/16", "37.20.0.0/16", "37.25.0.0/16",
                        "37.26.0.0/16", "37.29.0.0/16", "37.34.0.0/16",
                        "37.35.0.0/16", "37.44.0.0/16", "37.50.0.0/16",
                        "37.54.0.0/16", "37.62.0.0/16", "37.64.0.0/16",
                        "37.72.0.0/16", "37.75.0.0/16", "37.77.0.0/16",
                        "37.98.0.0/16", "37.101.0.0/16", "37.116.0.0/16",
                        "37.125.0.0/16", "37.131.0.0/16", "37.156.0.0/16",
                        "37.191.0.0/16", "37.192.0.0/16", "37.202.0.0/16",
                        "37.221.0.0/16", "37.235.0.0/16", "37.254.0.0/16",
                        "46.34.0.0/16", "46.51.0.0/16", "46.59.0.0/16",
                        "46.60.0.0/16", "46.63.0.0/16", "46.143.0.0/16",
                        "46.167.0.0/16", "46.218.0.0/16", "46.219.0.0/16",
                        "46.227.0.0/16", "62.220.0.0/16", "77.36.0.0/16",
                        "77.81.0.0/16", "77.238.0.0/16", "78.157.0.0/16",
                        "79.132.0.0/16", "79.175.0.0/16", "80.191.0.0/16",
                        "82.99.0.0/16", "82.115.0.0/16", "85.15.0.0/16",
                        "85.185.0.0/16", "87.107.0.0/16", "87.247.0.0/16",
                        "88.135.0.0/16", "91.99.0.0/16", "91.108.0.0/16",
                        "91.232.0.0/16", "92.43.0.0/16", "92.242.0.0/16",
                        "93.110.0.0/16", "93.117.0.0/16", "93.118.0.0/16",
                        "94.74.0.0/16", "94.101.0.0/16", "94.139.0.0/16",
                        "94.182.0.0/16", "94.183.0.0/16", "94.184.0.0/16",
                        "94.232.0.0/16", "94.241.0.0/16", "95.38.0.0/16",
                        "95.80.0.0/16", "95.81.0.0/16", "95.82.0.0/16",
                        "95.130.0.0/16", "95.215.0.0/16", "176.56.0.0/16",
                        "176.101.0.0/16", "178.216.0.0/16", "178.238.0.0/16",
                        "178.253.0.0/16", "188.121.0.0/16", "188.158.0.0/16"
                    },
                    RiskScore = 0.3
                },
                new ISPInfo
                {
                    Name = "RighTel",
                    NamePersian = "رایتل",
                    ASN = "AS57218",
                    IPRanges = new List<string>
                    {
                        "5.232.0.0/15", "5.226.0.0/16", "5.231.0.0/16",
                        "5.234.0.0/16", "5.235.0.0/16", "31.214.0.0/16",
                        "37.32.0.0/16", "37.98.0.0/16", "37.114.0.0/16",
                        "37.130.0.0/16", "37.152.0.0/16", "37.221.0.0/16",
                        "46.100.0.0/16", "46.148.0.0/16", "46.151.0.0/16",
                        "46.209.0.0/16", "46.224.0.0/16", "77.77.0.0/16",
                        "78.38.0.0/16", "78.39.0.0/16", "79.127.0.0/16",
                        "87.107.0.0/16", "91.98.0.0/16", "91.99.0.0/16",
                        "91.232.0.0/16", "94.74.0.0/16", "94.101.0.0/16",
                        "94.182.0.0/16", "95.38.0.0/16"
                    },
                    RiskScore = 0.35
                },
                new ISPInfo
                {
                    Name = "Shatel",
                    NamePersian = "شاتل",
                    ASN = "AS31549",
                    IPRanges = new List<string>
                    {
                        "5.200.0.0/16", "31.25.0.0/16", "31.170.0.0/16",
                        "37.10.0.0/16", "37.17.0.0/16", "37.20.0.0/16",
                        "37.25.0.0/16", "37.26.0.0/16", "37.29.0.0/16",
                        "37.34.0.0/16", "37.35.0.0/16", "37.44.0.0/16",
                        "37.50.0.0/16", "37.54.0.0/16", "37.62.0.0/16",
                        "37.64.0.0/16", "37.72.0.0/16", "37.75.0.0/16",
                        "37.77.0.0/16", "37.98.0.0/16", "37.101.0.0/16",
                        "37.116.0.0/16", "37.125.0.0/16", "37.131.0.0/16",
                        "37.156.0.0/16", "37.191.0.0/16", "37.192.0.0/16",
                        "37.202.0.0/16", "37.221.0.0/16", "37.235.0.0/16",
                        "46.34.0.0/16", "46.51.0.0/16", "46.59.0.0/16",
                        "46.60.0.0/16", "46.63.0.0/16", "77.81.0.0/16",
                        "78.157.0.0/16", "79.132.0.0/16", "79.175.0.0/16",
                        "82.99.0.0/16", "82.115.0.0/16", "85.15.0.0/16",
                        "87.107.0.0/16", "91.99.0.0/16", "91.108.0.0/16",
                        "91.232.0.0/16", "92.242.0.0/16", "93.110.0.0/16",
                        "93.117.0.0/16", "93.118.0.0/16", "94.182.0.0/16",
                        "94.183.0.0/16", "94.184.0.0/16", "94.232.0.0/16",
                        "95.38.0.0/16", "95.80.0.0/16", "95.81.0.0/16",
                        "95.82.0.0/16", "95.130.0.0/16", "95.215.0.0/16",
                        "178.216.0.0/16"
                    },
                    RiskScore = 0.3
                },
                new ISPInfo
                {
                    Name = "Pars Online",
                    NamePersian = "پارس آنلاین",
                    ASN = "AS16322",
                    IPRanges = new List<string>
                    {
                        "2.176.0.0/15", "2.178.0.0/16", "2.179.0.0/16",
                        "5.23.0.0/16", "5.28.0.0/16", "5.34.0.0/16",
                        "5.56.0.0/16", "5.62.0.0/16", "5.74.0.0/16",
                        "5.106.0.0/16", "5.118.0.0/16", "5.144.0.0/16",
                        "5.200.0.0/16", "31.7.0.0/16", "31.24.0.0/16",
                        "37.32.0.0/16", "37.49.0.0/16", "37.98.0.0/16",
                        "37.114.0.0/16", "37.128.0.0/16", "37.130.0.0/16",
                        "37.137.0.0/16", "37.152.0.0/16", "37.191.0.0/16",
                        "37.221.0.0/16", "37.255.0.0/16", "46.32.0.0/16",
                        "46.36.0.0/16", "46.38.0.0/16", "46.100.0.0/16",
                        "46.102.0.0/16", "46.143.0.0/16", "46.148.0.0/16",
                        "46.151.0.0/16", "46.167.0.0/16", "46.182.0.0/16",
                        "46.198.0.0/16", "46.209.0.0/16", "46.224.0.0/16",
                        "62.60.0.0/16", "62.193.0.0/16", "62.220.0.0/16",
                        "77.36.0.0/16", "77.77.0.0/16", "77.104.0.0/16",
                        "77.237.0.0/16", "77.238.0.0/16", "78.38.0.0/16",
                        "78.39.0.0/16", "78.109.0.0/16", "78.110.0.0/16",
                        "78.111.0.0/16", "79.127.0.0/16", "79.132.0.0/16",
                        "79.175.0.0/16", "80.71.0.0/16", "80.75.0.0/16",
                        "80.191.0.0/16", "81.12.0.0/16", "81.31.0.0/16",
                        "81.90.0.0/16", "81.91.0.0/16", "82.99.0.0/16",
                        "82.115.0.0/16", "85.9.0.0/16", "85.15.0.0/16",
                        "85.133.0.0/16", "85.185.0.0/16", "85.198.0.0/16",
                        "87.107.0.0/16", "87.247.0.0/16", "87.248.0.0/16",
                        "88.135.0.0/16", "91.98.0.0/16", "91.99.0.0/16",
                        "91.184.0.0/16", "91.185.0.0/16", "91.186.0.0/16",
                        "91.232.0.0/16", "91.236.0.0/16", "91.239.0.0/16",
                        "91.241.0.0/16", "91.242.0.0/16", "91.247.0.0/16",
                        "92.42.0.0/16", "93.110.0.0/16", "93.117.0.0/16",
                        "93.118.0.0/16", "94.74.0.0/16", "94.101.0.0/16",
                        "94.139.0.0/16", "94.182.0.0/16", "94.183.0.0/16",
                        "94.184.0.0/16", "94.232.0.0/16", "94.241.0.0/16",
                        "95.38.0.0/16", "95.80.0.0/16", "95.81.0.0/16",
                        "95.82.0.0/16", "95.130.0.0/16", "95.215.0.0/16",
                        "176.221.0.0/16", "176.56.0.0/16", "176.67.0.0/16",
                        "176.101.0.0/16", "178.131.0.0/16", "178.216.0.0/16",
                        "178.236.0.0/16", "178.238.0.0/16", "178.239.0.0/16",
                        "178.251.0.0/16", "178.252.0.0/16", "178.253.0.0/16",
                        "188.121.0.0/16", "188.136.0.0/16", "188.158.0.0/16",
                        "194.225.0.0/16"
                    },
                    RiskScore = 0.35
                },
                new ISPInfo
                {
                    Name = "HiWeb",
                    NamePersian = "های وب",
                    ASN = "AS44389",
                    IPRanges = new List<string>
                    {
                        "5.116.0.0/16", "5.117.0.0/16", "5.125.0.0/16",
                        "31.25.0.0/16", "37.10.0.0/16", "37.11.0.0/16",
                        "37.17.0.0/16", "37.20.0.0/16", "37.25.0.0/16",
                        "37.26.0.0/16", "37.29.0.0/16", "37.34.0.0/16",
                        "37.35.0.0/16", "37.44.0.0/16", "37.50.0.0/16",
                        "37.54.0.0/16", "37.62.0.0/16", "37.64.0.0/16",
                        "37.72.0.0/16", "37.75.0.0/16", "37.77.0.0/16",
                        "37.98.0.0/16", "37.101.0.0/16", "37.116.0.0/16",
                        "37.125.0.0/16", "37.131.0.0/16", "37.156.0.0/16",
                        "37.191.0.0/16", "37.192.0.0/16", "37.202.0.0/16",
                        "37.221.0.0/16", "37.235.0.0/16", "37.254.0.0/16",
                        "46.34.0.0/16", "46.51.0.0/16", "46.59.0.0/16",
                        "46.60.0.0/16", "46.63.0.0/16", "77.81.0.0/16",
                        "78.157.0.0/16", "79.132.0.0/16", "79.175.0.0/16",
                        "82.99.0.0/16", "82.115.0.0/16", "85.15.0.0/16",
                        "87.107.0.0/16", "91.99.0.0/16", "91.108.0.0/16",
                        "91.232.0.0/16", "92.242.0.0/16", "93.110.0.0/16",
                        "93.117.0.0/16", "93.118.0.0/16", "94.182.0.0/16",
                        "94.183.0.0/16", "94.184.0.0/16", "94.232.0.0/16",
                        "95.38.0.0/16", "95.80.0.0/16", "95.81.0.0/16",
                        "95.82.0.0/16", "95.130.0.0/16", "95.215.0.0/16",
                        "178.216.0.0/16"
                    },
                    RiskScore = 0.32
                }
            };
        }

        public static ISPInfo? GetISPByName(string name)
        {
            return ISPs.FirstOrDefault(i => 
                i.Name.Equals(name, StringComparison.OrdinalIgnoreCase));
        }

        public static ISPInfo? IdentifyISP(string ipAddress)
        {
            if (!IPAddress.TryParse(ipAddress, out var ip))
                return null;

            foreach (var isp in ISPs)
            {
                foreach (var network in isp.Networks)
                {
                    if (network.Contains(ip))
                        return isp;
                }
            }

            return null;
        }
    }
}
