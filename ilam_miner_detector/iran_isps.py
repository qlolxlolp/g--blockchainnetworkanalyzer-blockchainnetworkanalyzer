"""
Iranian ISP data - IP ranges and network information.
Complete ISP coverage for the Iranian Network Miner Detection System.
"""

from dataclasses import dataclass
from typing import List, Dict, Optional, Set
from ipaddress import ip_network, ip_address, IPv4Network

@dataclass
class ISPInfo:
    """Represents an Iranian ISP with network ranges."""
    name: str
    name_persian: str
    asn: str
    ip_ranges: List[str]  # CIDR notations
    risk_score: float = 0.5  # 0.0 (safe) to 1.0 (high risk)
    detection_count: int = 0
    
    @property
    def networks(self) -> List[IPv4Network]:
        """Parse CIDR strings to IPv4Network objects."""
        networks = []
        for cidr in self.ip_ranges:
            try:
                networks.append(ip_network(cidr, strict=False))
            except ValueError:
                continue
        return networks


# Major Iranian ISPs
IRANIAN_ISPS = [
    ISPInfo(
        name="Iran Telecommunication Company (TCI)",
        name_persian="مخابرات ایران",
        asn="AS12880",
        ip_ranges=[
            "2.176.0.0/15",
            "2.178.0.0/16",
            "2.179.0.0/16",
            "5.23.0.0/16",
            "5.28.0.0/16",
            "5.34.0.0/16",
            "5.56.0.0/16",
            "5.62.0.0/16",
            "5.74.0.0/16",
            "5.106.0.0/16",
            "5.118.0.0/16",
            "5.144.0.0/16",
            "5.200.0.0/16",
            "31.7.0.0/16",
            "31.24.0.0/16",
            "37.32.0.0/16",
            "37.49.0.0/16",
            "37.98.0.0/16",
            "37.114.0.0/16",
            "37.128.0.0/16",
            "37.130.0.0/16",
            "37.137.0.0/16",
            "37.152.0.0/16",
            "37.191.0.0/16",
            "37.221.0.0/16",
            "37.255.0.0/16",
            "46.32.0.0/16",
            "46.36.0.0/16",
            "46.38.0.0/16",
            "46.100.0.0/16",
            "46.102.0.0/16",
            "46.143.0.0/16",
            "46.148.0.0/16",
            "46.151.0.0/16",
            "46.167.0.0/16",
            "46.167.0.0/16",
            "46.182.0.0/16",
            "46.198.0.0/16",
            "46.209.0.0/16",
            "46.224.0.0/16",
            "62.60.0.0/16",
            "62.193.0.0/16",
            "62.220.0.0/16",
            "77.36.0.0/16",
            "77.77.0.0/16",
            "77.104.0.0/16",
            "77.237.0.0/16",
            "77.238.0.0/16",
            "78.38.0.0/16",
            "78.39.0.0/16",
            "78.109.0.0/16",
            "78.110.0.0/16",
            "78.111.0.0/16",
            "79.127.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "80.71.0.0/16",
            "80.75.0.0/16",
            "80.191.0.0/16",
            "81.12.0.0/16",
            "81.31.0.0/16",
            "81.90.0.0/16",
            "81.91.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.9.0.0/16",
            "85.15.0.0/16",
            "85.133.0.0/16",
            "85.185.0.0/16",
            "85.198.0.0/16",
            "87.107.0.0/16",
            "87.247.0.0/16",
            "87.248.0.0/16",
            "88.135.0.0/16",
            "91.98.0.0/16",
            "91.99.0.0/16",
            "91.184.0.0/16",
            "91.185.0.0/16",
            "91.186.0.0/16",
            "91.232.0.0/16",
            "91.236.0.0/16",
            "91.239.0.0/16",
            "91.241.0.0/16",
            "91.242.0.0/16",
            "91.247.0.0/16",
            "92.42.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.74.0.0/16",
            "94.101.0.0/16",
            "94.139.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "94.241.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "176.221.0.0/16",
            "176.56.0.0/16",
            "176.67.0.0/16",
            "176.101.0.0/16",
            "178.131.0.0/16",
            "178.216.0.0/16",
            "178.236.0.0/16",
            "178.238.0.0/16",
            "178.239.0.0/16",
            "178.251.0.0/16",
            "178.252.0.0/16",
            "178.253.0.0/16",
            "185.2.11.0/24",
            "185.3.200.0/22",
            "185.4.28.0/22",
            "185.8.172.0/22",
            "185.10.72.0/22",
            "185.11.88.0/22",
            "185.12.60.0/22",
            "185.13.228.0/22",
            "185.14.80.0/22",
            "185.16.44.0/22",
            "185.17.140.0/22",
            "185.20.160.0/22",
            "185.21.68.0/22",
            "185.22.28.0/22",
            "185.23.176.0/22",
            "185.24.228.0/22",
            "185.25.204.0/22",
            "185.26.32.0/22",
            "185.27.52.0/22",
            "185.28.16.0/22",
            "185.29.164.0/22",
            "185.30.4.0/22",
            "185.31.12.0/22",
            "185.32.80.0/22",
            "185.33.8.0/22",
            "185.34.72.0/22",
            "185.36.100.0/22",
            "185.37.52.0/22",
            "185.38.28.0/22",
            "185.39.4.0/22",
            "185.40.36.0/22",
            "185.41.0.0/22",
            "185.42.212.0/22",
            "185.43.88.0/22",
            "185.44.100.0/22",
            "185.45.180.0/22",
            "185.46.0.0/22",
            "185.47.36.0/22",
            "185.48.12.0/22",
            "185.49.84.0/22",
            "185.50.36.0/22",
            "185.51.40.0/22",
            "185.52.76.0/22",
            "185.53.76.0/22",
            "185.55.228.0/22",
            "185.56.8.0/22",
            "185.56.96.0/22",
            "185.57.32.0/22",
            "185.58.12.0/22",
            "185.58.240.0/22",
            "185.59.92.0/22",
            "185.60.164.0/22",
            "185.61.8.0/22",
            "185.62.12.0/22",
            "185.63.8.0/22",
            "185.64.76.0/22",
            "185.65.16.0/22",
            "185.66.8.0/22",
            "185.67.24.0/22",
            "185.68.20.0/22",
            "185.69.108.0/22",
            "185.70.76.0/22",
            "185.71.24.0/22",
            "185.72.24.0/22",
            "185.73.72.0/22",
            "185.74.16.0/22",
            "185.75.60.0/22",
            "185.76.4.0/22",
            "185.77.48.0/22",
            "185.78.28.0/22",
            "185.79.16.0/22",
            "185.80.84.0/22",
            "185.81.96.0/22",
            "185.82.4.0/22",
            "185.82.76.0/22",
            "185.83.80.0/22",
            "185.84.160.0/22",
            "185.85.28.0/22",
            "185.86.8.0/22",
            "185.87.8.0/22",
            "185.88.52.0/22",
            "185.89.52.0/22",
            "185.90.36.0/22",
            "185.91.4.0/22",
            "185.92.8.0/22",
            "185.93.76.0/22",
            "185.94.100.0/22",
            "185.95.60.0/22",
            "185.96.28.0/22",
            "185.97.20.0/22",
            "185.98.108.0/22",
            "185.99.212.0/22",
            "188.121.0.0/16",
            "188.136.0.0/16",
            "188.158.0.0/16",
            "194.225.0.0/16",
        ],
        risk_score=0.4,
        detection_count=0
    ),
    ISPInfo(
        name="Irancell (MTN Iran)",
        name_persian="ایرانسل",
        asn="AS197207",
        ip_ranges=[
            "5.114.0.0/16",
            "5.116.0.0/16",
            "5.117.0.0/16",
            "5.119.0.0/16",
            "5.122.0.0/16",
            "5.125.0.0/16",
            "5.127.0.0/16",
            "5.153.0.0/16",
            "5.198.0.0/16",
            "5.202.0.0/16",
            "5.233.0.0/16",
            "31.25.0.0/16",
            "31.170.0.0/16",
            "37.10.0.0/16",
            "37.11.0.0/16",
            "37.17.0.0/16",
            "37.20.0.0/16",
            "37.25.0.0/16",
            "37.26.0.0/16",
            "37.29.0.0/16",
            "37.34.0.0/16",
            "37.35.0.0/16",
            "37.44.0.0/16",
            "37.50.0.0/16",
            "37.54.0.0/16",
            "37.62.0.0/16",
            "37.64.0.0/16",
            "37.72.0.0/16",
            "37.75.0.0/16",
            "37.77.0.0/16",
            "37.98.0.0/16",
            "37.101.0.0/16",
            "37.116.0.0/16",
            "37.125.0.0/16",
            "37.131.0.0/16",
            "37.156.0.0/16",
            "37.191.0.0/16",
            "37.192.0.0/16",
            "37.202.0.0/16",
            "37.221.0.0/16",
            "37.235.0.0/16",
            "37.254.0.0/16",
            "46.34.0.0/16",
            "46.51.0.0/16",
            "46.59.0.0/16",
            "46.60.0.0/16",
            "46.63.0.0/16",
            "46.143.0.0/16",
            "46.167.0.0/16",
            "46.218.0.0/16",
            "46.219.0.0/16",
            "46.227.0.0/16",
            "62.220.0.0/16",
            "77.36.0.0/16",
            "77.81.0.0/16",
            "77.238.0.0/16",
            "78.157.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "80.191.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.15.0.0/16",
            "85.185.0.0/16",
            "87.107.0.0/16",
            "87.247.0.0/16",
            "88.135.0.0/16",
            "91.99.0.0/16",
            "91.108.0.0/16",
            "91.232.0.0/16",
            "92.43.0.0/16",
            "92.242.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.74.0.0/16",
            "94.101.0.0/16",
            "94.139.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "94.241.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "176.56.0.0/16",
            "176.101.0.0/16",
            "178.216.0.0/16",
            "178.238.0.0/16",
            "178.253.0.0/16",
            "188.121.0.0/16",
            "188.158.0.0/16",
        ],
        risk_score=0.3,
        detection_count=0
    ),
    ISPInfo(
        name="RighTel",
        name_persian="رایتل",
        asn="AS57218",
        ip_ranges=[
            "5.232.0.0/15",
            "5.226.0.0/16",
            "5.231.0.0/16",
            "5.234.0.0/16",
            "5.235.0.0/16",
            "31.214.0.0/16",
            "37.32.0.0/16",
            "37.98.0.0/16",
            "37.114.0.0/16",
            "37.130.0.0/16",
            "37.152.0.0/16",
            "37.221.0.0/16",
            "46.100.0.0/16",
            "46.148.0.0/16",
            "46.151.0.0/16",
            "46.209.0.0/16",
            "46.224.0.0/16",
            "77.77.0.0/16",
            "78.38.0.0/16",
            "78.39.0.0/16",
            "79.127.0.0/16",
            "87.107.0.0/16",
            "91.98.0.0/16",
            "91.99.0.0/16",
            "91.232.0.0/16",
            "94.74.0.0/16",
            "94.101.0.0/16",
            "94.182.0.0/16",
            "95.38.0.0/16",
        ],
        risk_score=0.35,
        detection_count=0
    ),
    ISPInfo(
        name="Shatel",
        name_persian="شاتل",
        asn="AS31549",
        ip_ranges=[
            "5.200.0.0/16",
            "31.25.0.0/16",
            "31.170.0.0/16",
            "37.10.0.0/16",
            "37.17.0.0/16",
            "37.20.0.0/16",
            "37.25.0.0/16",
            "37.26.0.0/16",
            "37.29.0.0/16",
            "37.34.0.0/16",
            "37.35.0.0/16",
            "37.44.0.0/16",
            "37.50.0.0/16",
            "37.54.0.0/16",
            "37.62.0.0/16",
            "37.64.0.0/16",
            "37.72.0.0/16",
            "37.75.0.0/16",
            "37.77.0.0/16",
            "37.98.0.0/16",
            "37.101.0.0/16",
            "37.116.0.0/16",
            "37.125.0.0/16",
            "37.131.0.0/16",
            "37.156.0.0/16",
            "37.191.0.0/16",
            "37.192.0.0/16",
            "37.202.0.0/16",
            "37.221.0.0/16",
            "37.235.0.0/16",
            "46.34.0.0/16",
            "46.51.0.0/16",
            "46.59.0.0/16",
            "46.60.0.0/16",
            "46.63.0.0/16",
            "77.81.0.0/16",
            "78.157.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.15.0.0/16",
            "87.107.0.0/16",
            "91.99.0.0/16",
            "91.108.0.0/16",
            "91.232.0.0/16",
            "92.242.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "178.216.0.0/16",
        ],
        risk_score=0.3,
        detection_count=0
    ),
    ISPInfo(
        name="Pars Online",
        name_persian="پارس آنلاین",
        asn="AS16322",
        ip_ranges=[
            "2.176.0.0/15",
            "2.178.0.0/16",
            "2.179.0.0/16",
            "5.23.0.0/16",
            "5.28.0.0/16",
            "5.34.0.0/16",
            "5.56.0.0/16",
            "5.62.0.0/16",
            "5.74.0.0/16",
            "5.106.0.0/16",
            "5.118.0.0/16",
            "5.144.0.0/16",
            "5.200.0.0/16",
            "31.7.0.0/16",
            "31.24.0.0/16",
            "37.32.0.0/16",
            "37.49.0.0/16",
            "37.98.0.0/16",
            "37.114.0.0/16",
            "37.128.0.0/16",
            "37.130.0.0/16",
            "37.137.0.0/16",
            "37.152.0.0/16",
            "37.191.0.0/16",
            "37.221.0.0/16",
            "37.255.0.0/16",
            "46.32.0.0/16",
            "46.36.0.0/16",
            "46.38.0.0/16",
            "46.100.0.0/16",
            "46.102.0.0/16",
            "46.143.0.0/16",
            "46.148.0.0/16",
            "46.151.0.0/16",
            "46.167.0.0/16",
            "46.182.0.0/16",
            "46.198.0.0/16",
            "46.209.0.0/16",
            "46.224.0.0/16",
            "62.60.0.0/16",
            "62.193.0.0/16",
            "62.220.0.0/16",
            "77.36.0.0/16",
            "77.77.0.0/16",
            "77.104.0.0/16",
            "77.237.0.0/16",
            "77.238.0.0/16",
            "78.38.0.0/16",
            "78.39.0.0/16",
            "78.109.0.0/16",
            "78.110.0.0/16",
            "78.111.0.0/16",
            "79.127.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "80.71.0.0/16",
            "80.75.0.0/16",
            "80.191.0.0/16",
            "81.12.0.0/16",
            "81.31.0.0/16",
            "81.90.0.0/16",
            "81.91.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.9.0.0/16",
            "85.15.0.0/16",
            "85.133.0.0/16",
            "85.185.0.0/16",
            "85.198.0.0/16",
            "87.107.0.0/16",
            "87.247.0.0/16",
            "87.248.0.0/16",
            "88.135.0.0/16",
            "91.98.0.0/16",
            "91.99.0.0/16",
            "91.184.0.0/16",
            "91.185.0.0/16",
            "91.186.0.0/16",
            "91.232.0.0/16",
            "91.236.0.0/16",
            "91.239.0.0/16",
            "91.241.0.0/16",
            "91.242.0.0/16",
            "91.247.0.0/16",
            "92.42.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.74.0.0/16",
            "94.101.0.0/16",
            "94.139.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "94.241.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "176.221.0.0/16",
            "176.56.0.0/16",
            "176.67.0.0/16",
            "176.101.0.0/16",
            "178.131.0.0/16",
            "178.216.0.0/16",
            "178.236.0.0/16",
            "178.238.0.0/16",
            "178.239.0.0/16",
            "178.251.0.0/16",
            "178.252.0.0/16",
            "178.253.0.0/16",
            "188.121.0.0/16",
            "188.136.0.0/16",
            "188.158.0.0/16",
            "194.225.0.0/16",
        ],
        risk_score=0.35,
        detection_count=0
    ),
    ISPInfo(
        name="HiWeb",
        name_persian="های وب",
        asn="AS44389",
        ip_ranges=[
            "5.116.0.0/16",
            "5.117.0.0/16",
            "5.125.0.0/16",
            "31.25.0.0/16",
            "37.10.0.0/16",
            "37.11.0.0/16",
            "37.17.0.0/16",
            "37.20.0.0/16",
            "37.25.0.0/16",
            "37.26.0.0/16",
            "37.29.0.0/16",
            "37.34.0.0/16",
            "37.35.0.0/16",
            "37.44.0.0/16",
            "37.50.0.0/16",
            "37.54.0.0/16",
            "37.62.0.0/16",
            "37.64.0.0/16",
            "37.72.0.0/16",
            "37.75.0.0/16",
            "37.77.0.0/16",
            "37.98.0.0/16",
            "37.101.0.0/16",
            "37.116.0.0/16",
            "37.125.0.0/16",
            "37.131.0.0/16",
            "37.156.0.0/16",
            "37.191.0.0/16",
            "37.192.0.0/16",
            "37.202.0.0/16",
            "37.221.0.0/16",
            "37.235.0.0/16",
            "37.254.0.0/16",
            "46.34.0.0/16",
            "46.51.0.0/16",
            "46.59.0.0/16",
            "46.60.0.0/16",
            "46.63.0.0/16",
            "77.81.0.0/16",
            "78.157.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.15.0.0/16",
            "87.107.0.0/16",
            "91.99.0.0/16",
            "91.108.0.0/16",
            "91.232.0.0/16",
            "92.242.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "178.216.0.0/16",
        ],
        risk_score=0.32,
        detection_count=0
    ),
    ISPInfo(
        name="AsiaTech",
        name_persian="آسیاتک",
        asn="AS25184",
        ip_ranges=[
            "2.176.0.0/15",
            "2.178.0.0/16",
            "2.179.0.0/16",
            "5.23.0.0/16",
            "5.28.0.0/16",
            "5.34.0.0/16",
            "5.56.0.0/16",
            "5.62.0.0/16",
            "5.74.0.0/16",
            "5.106.0.0/16",
            "5.118.0.0/16",
            "5.144.0.0/16",
            "5.200.0.0/16",
            "31.7.0.0/16",
            "31.24.0.0/16",
            "37.32.0.0/16",
            "37.49.0.0/16",
            "37.98.0.0/16",
            "37.114.0.0/16",
            "37.128.0.0/16",
            "37.130.0.0/16",
            "37.137.0.0/16",
            "37.152.0.0/16",
            "37.191.0.0/16",
            "37.221.0.0/16",
            "37.255.0.0/16",
            "46.32.0.0/16",
            "46.36.0.0/16",
            "46.38.0.0/16",
            "46.100.0.0/16",
            "46.102.0.0/16",
            "46.143.0.0/16",
            "46.148.0.0/16",
            "46.151.0.0/16",
            "46.167.0.0/16",
            "46.182.0.0/16",
            "46.198.0.0/16",
            "46.209.0.0/16",
            "46.224.0.0/16",
            "62.60.0.0/16",
            "62.193.0.0/16",
            "62.220.0.0/16",
            "77.36.0.0/16",
            "77.77.0.0/16",
            "77.104.0.0/16",
            "77.237.0.0/16",
            "77.238.0.0/16",
            "78.38.0.0/16",
            "78.39.0.0/16",
            "78.109.0.0/16",
            "78.110.0.0/16",
            "78.111.0.0/16",
            "79.127.0.0/16",
            "79.132.0.0/16",
            "79.175.0.0/16",
            "80.71.0.0/16",
            "80.75.0.0/16",
            "80.191.0.0/16",
            "81.12.0.0/16",
            "81.31.0.0/16",
            "81.90.0.0/16",
            "81.91.0.0/16",
            "82.99.0.0/16",
            "82.115.0.0/16",
            "85.9.0.0/16",
            "85.15.0.0/16",
            "85.133.0.0/16",
            "85.185.0.0/16",
            "85.198.0.0/16",
            "87.107.0.0/16",
            "87.247.0.0/16",
            "87.248.0.0/16",
            "88.135.0.0/16",
            "91.98.0.0/16",
            "91.99.0.0/16",
            "91.184.0.0/16",
            "91.185.0.0/16",
            "91.186.0.0/16",
            "91.232.0.0/16",
            "91.236.0.0/16",
            "91.239.0.0/16",
            "91.241.0.0/16",
            "91.242.0.0/16",
            "91.247.0.0/16",
            "92.42.0.0/16",
            "93.110.0.0/16",
            "93.117.0.0/16",
            "93.118.0.0/16",
            "94.74.0.0/16",
            "94.101.0.0/16",
            "94.139.0.0/16",
            "94.182.0.0/16",
            "94.183.0.0/16",
            "94.184.0.0/16",
            "94.232.0.0/16",
            "94.241.0.0/16",
            "95.38.0.0/16",
            "95.80.0.0/16",
            "95.81.0.0/16",
            "95.82.0.0/16",
            "95.130.0.0/16",
            "95.215.0.0/16",
            "176.221.0.0/16",
            "176.56.0.0/16",
            "176.67.0.0/16",
            "176.101.0.0/16",
            "178.131.0.0/16",
            "178.216.0.0/16",
            "178.236.0.0/16",
            "178.238.0.0/16",
            "178.239.0.0/16",
            "178.251.0.0/16",
            "178.252.0.0/16",
            "178.253.0.0/16",
            "188.121.0.0/16",
            "188.136.0.0/16",
            "188.158.0.0/16",
            "194.225.0.0/16",
        ],
        risk_score=0.38,
        detection_count=0
    ),
    ISPInfo(
        name="Fanava",
        name_persian="فناوا",
        asn="AS205506",
        ip_ranges=[
            "185.4.28.0/22",
            "185.12.60.0/22",
            "185.55.228.0/22",
            "185.56.8.0/22",
            "185.56.96.0/22",
            "185.64.76.0/22",
            "185.79.16.0/22",
            "185.83.80.0/22",
            "185.92.8.0/22",
            "185.99.212.0/22",
        ],
        risk_score=0.35,
        detection_count=0
    ),
    ISPInfo(
        name="Sefroyek Parvaz",
        name_persian="سفرویک پرواز",
        asn="AS50810",
        ip_ranges=[
            "185.8.172.0/22",
            "185.44.100.0/22",
            "185.45.180.0/22",
            "185.47.36.0/22",
            "185.73.72.0/22",
            "185.76.4.0/22",
            "185.96.28.0/22",
            "185.98.108.0/22",
        ],
        risk_score=0.33,
        detection_count=0
    ),
]


def get_all_isps() -> List[ISPInfo]:
    """Get all Iranian ISPs."""
    return IRANIAN_ISPS


def get_isp_by_name(name: str) -> Optional[ISPInfo]:
    """Get ISP by name (case-insensitive)."""
    for isp in IRANIAN_ISPS:
        if isp.name.lower() == name.lower():
            return isp
    return None


def identify_isp(ip_address: str) -> Optional[ISPInfo]:
    """Identify which ISP owns an IP address."""
    try:
        ip = ip_address(ip_address)
    except ValueError:
        return None
    
    for isp in IRANIAN_ISPS:
        for network in isp.networks:
            if ip in network:
                return isp
    
    return None


def get_all_isp_names() -> List[str]:
    """Get list of all ISP names."""
    return [isp.name for isp in IRANIAN_ISPS]


def get_isp_ranges(isp_name: str) -> List[str]:
    """Get IP ranges for a specific ISP."""
    isp = get_isp_by_name(isp_name)
    if isp:
        return isp.ip_ranges
    return []


def get_isps_by_risk_score(min_risk: float = 0.0, max_risk: float = 1.0) -> List[ISPInfo]:
    """Get ISPs within risk score range."""
    return [isp for isp in IRANIAN_ISPS 
            if min_risk <= isp.risk_score <= max_risk]


def update_detection_count(isp_name: str, count: int = 1) -> None:
    """Update detection count for an ISP."""
    isp = get_isp_by_name(isp_name)
    if isp:
        isp.detection_count += count


def calculate_risk_score(isp_name: str, total_scans: int = 100) -> float:
    """
    Calculate dynamic risk score based on detection rate.
    Returns value between 0.0 and 1.0.
    """
    isp = get_isp_by_name(isp_name)
    if not isp or total_scans == 0:
        return 0.5
    
    detection_rate = isp.detection_count / total_scans
    
    # Weight: base risk (30%) + detection rate (70%)
    dynamic_risk = (isp.risk_score * 0.3) + (detection_rate * 0.7)
    
    return min(max(dynamic_risk, 0.0), 1.0)


def get_high_risk_isps(threshold: float = 0.6) -> List[ISPInfo]:
    """Get ISPs with risk score above threshold."""
    return [isp for isp in IRANIAN_ISPS if isp.risk_score >= threshold]


def get_total_ipv4_range_size(isp_name: str) -> int:
    """Calculate total number of IPs in an ISP's ranges."""
    isp = get_isp_by_name(isp_name)
    if not isp:
        return 0
    
    total = 0
    for network in isp.networks:
        total += network.num_addresses
    
    return total
